–ß–∞—Å—Ç—å 1. –ò–î–ï–ê–õ–¨–ù–´–ï –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–∫–µ—Ç–æ–≤ –¥–ª—è —Å–≤–µ—Ä—Ö–±—ã—Å—Ç—Ä–æ–π –ø–µ—Ä–µ–¥–∞—á–∏

–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:

—á–∞—Ç–æ–≤

—Å—Ç—Ä–∏–º–∏–Ω–≥–∞ —Å–æ–±—ã—Ç–∏–π

—Ñ–∞–π–ª–æ–≤–æ–≥–æ –æ–±–º–µ–Ω–∞

RPC DevApps

–ø—Ä–æ—Ç–æ–∫–æ–ª–∞ JetStreamProto –Ω–∞ —Å—ã—Ä–æ–º TCP/UDP



---

‚úÖ TCP (–Ω–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ + —Å–∫–æ—Ä–æ—Å—Ç—å)

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ/–∫–ª–∏–µ–Ω—Ç–µ:

SO_REUSEADDR = 1
SO_REUSEPORT = 1
TCP_NODELAY = 1             # –æ—Ç–∫–ª—é—á–∏—Ç—å Nagle
TCP_QUICKACK = 1            # —É—Å–∫–æ—Ä–∏—Ç—å ACK
SO_KEEPALIVE = 1
TCP_KEEPIDLE = 30
TCP_KEEPINTVL = 10
TCP_KEEPCNT = 3
SO_RCVBUF = 4MB
SO_SNDBUF = 4MB

–ö–æ–º–∞–Ω–¥–∞–º–∏ sysctl:

net.core.rmem_default = 8388608
net.core.wmem_default = 8388608
net.core.rmem_max = 67108864
net.core.wmem_max = 67108864
net.ipv4.tcp_rmem = 4096 87380 67108864
net.ipv4.tcp_wmem = 4096 65536 67108864
net.ipv4.tcp_fastopen = 3
net.ipv4.tcp_mtu_probing = 1
net.core.somaxconn = 4096


---

üöÄ UDP (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å + FEC + –º–∏–Ω–∏–º—É–º –∑–∞–¥–µ—Ä–∂–µ–∫)

SO_RCVBUF = 4MB
SO_SNDBUF = 4MB
IP_RECVERR = 1
IP_MTU_DISCOVER = 1
SO_REUSEPORT = 1


---

üî• io_uring (Linux 5.10+)

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –µ—Å–ª–∏:

–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

–º–∏–Ω–∏–º—É–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞


–≠—Ñ—Ñ–µ–∫—Ç ‚Äî –¥–æ 40‚Äì70% –≤—ã—à–µ —Å–∫–æ—Ä–æ—Å—Ç—å —á–µ–º epoll.


---

üß© FEC-—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ UDP –¥–ª—è JetStreamProto:

Reed-Solomon 10/2 (10 –ø–æ–ª–µ–∑–Ω—ã—Ö + 2 –∫–æ—Ä—Ä. –±–ª–æ–∫–∞) ‚Äî –∑–æ–ª–æ—Ç–æ.


---

üéØ –ò—Ç–æ–≥ –ø–æ —Å–æ–∫–µ—Ç–∞–º:

TCP –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
UDP+FEC –¥–ª—è —Ñ–∞–π–ª–æ–≤/—Å—Ç—Ä–∏–º–æ–≤
io_uring –¥–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤
SO_REUSEPORT –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏
TCP_NODELAY –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏


---

üî• –ß–∞—Å—Ç—å 2. –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–µ–∫ —Å–≤–µ—Ä—Ö–±—ã—Å—Ç—Ä–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –¥–ª—è JetStreamProto

–≠—Ç–æ –ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –ø–æ–¥ –≤–∞—à—É –∑–∞–¥–∞—á—É:


---

üöÄ –í–∞—Ä–∏–∞–Ω—Ç A (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π, –∏–Ω—Ç–µ—Ä–Ω–µ—Ç + LAN):

TRANSPORT

‚úî QUIC (—á–µ—Ä–µ–∑ quic-go –∏–ª–∏ msquic)
–∏–ª–∏
‚úî TCP (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω —Å–≤–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª –ø–æ–≤–µ—Ä—Ö)

SERIALIZATION

‚úî FlatBuffers (–Ω—É–ª–µ–≤–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ)
–∏–ª–∏ Cap'n Proto

COMPRESSION

‚úî LZ4 (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)

ENCRYPTION

‚úî AES-256-GCM —Å AES-NI
‚úî ECDH –æ–±–º–µ–Ω –∫–ª—é—á–∞–º–∏

RELIABILITY

‚úî ACK + selective resend
‚úî seq_id
‚úî —á–∞–Ω–∫–∏

UDP-FEC –ú–û–î–£–õ–¨ (–¥–ª—è —Ñ–∞–π–ª–æ–≤)

‚úî Reed-Solomon
‚úî Sliding-window chunks
‚úî Zero-copy buffers


---

üß© –°—Ö–µ–º–∞ —Å—Ç–µ–∫–∞

[JetStreamProto Packet]
       ‚Üì
[FlatBuffers]
       ‚Üì
[Encryption AES-GCM]
       ‚Üì
[Transport Layer]
   ‚îú‚îÄ QUIC (–æ—Å–Ω–æ–≤–Ω–æ–π)
   ‚îú‚îÄ TCP (fallback)
   ‚îî‚îÄ UDP+FEC (bulk data)
       ‚Üì
[Sockets]
   ‚îú‚îÄ SO_REUSEPORT
   ‚îú‚îÄ TCP_NODELAY
   ‚îú‚îÄ io_uring


---

üî• –ß–∞—Å—Ç—å 3. –ì–æ—Ç–æ–≤—ã–π –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä/–∫–ª–∏–µ–Ω—Ç (Go + TCP + –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)

üü© server.go

package main

import (
    "log"
    "net"
    "syscall"
)

func main() {
    lc := net.ListenConfig{
        Control: func(_, _ string, c syscall.RawConn) error {
            return c.Control(func(fd uintptr) {
                syscall.SetsockoptInt(int(fd), syscall.SOL_SOCKET, syscall.SO_REUSEADDR, 1)
                syscall.SetsockoptInt(int(fd), syscall.SOL_SOCKET, syscall.SO_REUSEPORT, 1)
                syscall.SetsockoptInt(int(fd), syscall.IPPROTO_TCP, syscall.TCP_NODELAY, 1)
                syscall.SetsockoptInt(int(fd), syscall.IPPROTO_TCP, syscall.TCP_QUICKACK, 1)
                syscall.SetsockoptInt(int(fd), syscall.SOL_SOCKET, syscall.SO_RCVBUF, 4*1024*1024)
                syscall.SetsockoptInt(int(fd), syscall.SOL_SOCKET, syscall.SO_SNDBUF, 4*1024*1024)
            })
        },
    }

    ln, err := lc.Listen(context.Background(), "tcp", ":8080")
    if err != nil {
        log.Fatal(err)
    }
    defer ln.Close()

    for {
        conn, err := ln.Accept()
        if err != nil {
            continue
        }
        go handle(conn)
    }
}

func handle(conn net.Conn) {
    buf := make([]byte, 4096)
    for {
        n, err := conn.Read(buf)
        if err != nil {
            return
        }
        conn.Write(buf[:n])
    }
}


---

üü¶ client.go

package main

import (
    "log"
    "net"
    "syscall"
)

func main() {
    d := net.Dialer{
        Control: func(_, _ string, c syscall.RawConn) error {
            return c.Control(func(fd uintptr) {
                syscall.SetsockoptInt(int(fd), syscall.IPPROTO_TCP, syscall.TCP_NODELAY, 1)
                syscall.SetsockoptInt(int(fd), syscall.SOL_SOCKET, syscall.SO_RCVBUF, 4*1024*1024)
                syscall.SetsockoptInt(int(fd), syscall.SOL_SOCKET, syscall.SO_SNDBUF, 4*1024*1024)
            })
        },
    }

    conn, err := d.Dial("tcp", "127.0.0.1:8080")
    if err != nil {
        log.Fatal(err)
    }

    conn.Write([]byte("Hello"))
}

